
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>The DifCal Tab &#8212; SNAPRed User Documentation v0.2</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'testPanel/difcal';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The NormCal Tab" href="normcal.html" />
    <link rel="prev" title="Test Panel: User Guide" href="overview.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo2.png" class="logo__image only-light" alt="SNAPRed User Documentation v0.2 - Home"/>
    <script>document.write(`<img src="../_static/logo2.png" class="logo__image only-dark" alt="SNAPRed User Documentation v0.2 - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    SNAPRed User Docs v 0.2
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../coreConcepts/overview.html">Core Concepts in SNAPRed</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../coreConcepts/applicationYML.html">Global configuration</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../diffCalib/overview.html">Diffraction Calibration</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../diffCalib/diffCal1.html">Diffraction Calibration part 1: pixel calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../diffCalib/diffCal2.html">Diffraction Calibration Part 2: Group Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../diffCalib/diffCal_assessment_output.html">Calibration assessment, completion and output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../normCalib/overview.html">Normalisation Calibration</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="overview.html">Test Panel: User Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">The DifCal Tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="normcal.html">The NormCal Tab</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bib.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/neutrons/SNAPRed" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/neutrons/SNAPRed/issues/new?title=Issue%20on%20page%20%2FtestPanel/difcal.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/testPanel/difcal.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>The DifCal Tab</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-tab-diffraction-calibration">First tab: Diffraction Calibration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explanation-of-fields">Explanation of fields</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#second-tab-tweak-peak-peek">Second tab: Tweak Peak Peek</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#third-tab-assessing">Third tab: Assessing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fourth-tab-saving">Fourth tab: Saving</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="the-difcal-tab">
<h1>The DifCal Tab<a class="headerlink" href="#the-difcal-tab" title="Link to this heading">#</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">DifCal</span></code> tab provides access to <a class="reference internal" href="../diffCalib/overview.html#label-difcal"><span class="std std-ref">the diffraction calibration workflow</span></a>. At certain points in the workflow, user interaction is needed and this is facilitated by four different tabs in the interface. The workflows are linear, beginning on the first tab and transiting one tab at a time through the entire workflow. The <code class="docutils literal notranslate"><span class="pre">Cancel</span></code> button can be clicked at any time and will reinitialise the interface (deleting any existing workspaces).</p>
<section id="first-tab-diffraction-calibration">
<h2>First tab: Diffraction Calibration<a class="headerlink" href="#first-tab-diffraction-calibration" title="Link to this heading">#</a></h2>
<p>The first tab in the panel allows the configuration of the calibration, requiring a set of inputs specified either via text fields or drop down menus. All inputs must have valid values in order to progress to the next tab, which is done by pressing <code class="docutils literal notranslate"><span class="pre">Continue</span></code>.</p>
<figure class="align-default" id="difcal1">
<a class="reference internal image-reference" href="../_images/difcal1.png"><img alt="../_images/difcal1.png" src="../_images/difcal1.png" style="height: 350px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">The first tab in the difCal workflow used to configure the initial calibration</span><a class="headerlink" href="#difcal1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<section id="explanation-of-fields">
<h3>Explanation of fields<a class="headerlink" href="#explanation-of-fields" title="Link to this heading">#</a></h3>
<p><strong>Run Number:</strong> This is the run number of a dataset from a crystalline calibrant sample. Value must be &gt;= 46342</p>
<p><strong>Lite Mode:</strong> This toggle enables or disables <a class="reference internal" href="../coreConcepts/overview.html#label-lite"><span class="std std-ref">Lite Mode</span></a> (default is <code class="docutils literal notranslate"><span class="pre">ON</span></code>)</p>
<p><strong>Convergence Threshold:</strong> This is an input to the <a class="reference internal" href="../diffCalib/diffCal1.html#label-cc"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">CrossCorrelation</span> <span class="pre">algorithm</span></code></span></a>. The algorithm is set up to reexecute iteratively, determining and then applying the offset correction in each iteration. This should result in smaller and smaller offsets. This will continue until the average offset (measured in number of logarithmic bins) becomes less than the requested <code class="docutils literal notranslate"><span class="pre">Convergence</span> <span class="pre">Threshold</span></code>, or when a define maximum number of cycles is reached (default is 5, can be adjusted via the parameter <code class="docutils literal notranslate"><span class="pre">maximumIterations</span></code> in <code class="docutils literal notranslate"><span class="pre">application.yml</span></code>).</p>
<p><strong>Peak Intensity Threshold:</strong> This allows user specification of the minimum (estimated) intensity of Bragg peaks to use as a fraction of the intensity of the strongest peak. Setting to 0.0 will include all peaks. The effect of this parameter can be inspected on the next tab where it can be adjusted.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In testing, it was noted that (as a result of the huge <span class="math notranslate nohighlight">\(F_{obs}^2\)</span> of the diamond 111 reflection) a value of 0 works best for this calibrant. In contrast, 0.01 is found to be a good value for silicon, but this needs to be fine tuned as it depends on the counting statistics of the measurement, with longer collections allowing the inclusion of weaker peaks.</p>
</div>
<p><strong>Bins Across Peak Width:</strong> This parameter provides <em>global control</em> of the output binning and works by allowing user specification of the number of (logarithmic) bins across the FWHM of any given Bragg peak, at native instrument resolution for a given state as described <a class="reference internal" href="../coreConcepts/overview.html#binning-considerations"><span class="std std-ref">here</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The intension is to make <code class="docutils literal notranslate"><span class="pre">Bins</span> <span class="pre">Across</span> <span class="pre">Peak</span> <span class="pre">Width</span></code> a fixed number for all data reduction. However, this parameter has been exposed to enable testing. The final value should be sufficient to allow Rietveld refinement of GSAS Profile Function 3 (or equivalent). The possiblity to <em>down sample</em> from this native resolution will also be supported, however, the default binning parameter should reflect the native resolution of the instrument.</p>
</div>
<p><strong>Sample:</strong> This allows user selection of the available diffraction calibrants.</p>
<p><strong>Grouping File:</strong> This allows user selection of the available pixel grouping schemes that can be used for calibration. This is a fundamental input to the diffraction calibration as both the pixel calibration <em>and</em> the group calibration are conducted group by group. The available groups consist of the “standard” detector-component based groupings (e.g. <code class="docutils literal notranslate"><span class="pre">Bank</span></code>, <code class="docutils literal notranslate"><span class="pre">Column</span></code>…) however it’s also possible to use arbitrary pixel grouping schemes, specified for a given instrument state. The latter allows the use of 2<span class="math notranslate nohighlight">\(\theta\)</span>-based grouping, which may give better quality calibrations, particularly for states where detectors are at extreme angles.</p>
<p><strong>Peak Function:</strong> This allows selection of the peak shape to use during group calibration. At present, only symmetric peak shapes are available. The best choice varies for different calibrants (e.g. the SNAP diamond calibrant exhibits a strong Lorentzian profile). The current plan would be to ultimately transition to a more realistic TOF peak shape, but this requires modification of the underlying mantid algorithm <code class="docutils literal notranslate"><span class="pre">PDCalibration</span></code> to allow constraints including the fixing of global values of the exponential α and β terms. (NOTE: the <code class="docutils literal notranslate"><span class="pre">psuedovoigt</span></code> peakshape appears to diverge most of the time).</p>
</section>
</section>
<section id="second-tab-tweak-peak-peek">
<h2>Second tab: Tweak Peak Peek<a class="headerlink" href="#second-tab-tweak-peak-peek" title="Link to this heading">#</a></h2>
<figure class="align-default">
<img alt="../_images/difcal2.png" src="../_images/difcal2.png" />
</figure>
<p>The <code class="docutils literal notranslate"><span class="pre">Tweak</span> <span class="pre">Peak</span> <span class="pre">Peek</span></code> tab allows visual inspection of the diffraction focused data (using the calibration pixel grouping scheme) enabling configuration of the subsequent <a class="reference internal" href="../diffCalib/diffCal2.html#group-cal"><span class="std std-ref">Group Calibration</span></a> part of the algorithm. Each spectrum is associated with a list of calibrant bragg peak positions. This list is derived from the calibrant cif file and can be filtered by user specification of d-spacing limits (and indicated by vertyical red lines on each spectrum) and <code class="docutils literal notranslate"><span class="pre">intensity</span> <span class="pre">threshold</span></code>. Each peak has an associated “peak extent”, which delimits left and right hand boundaries that will be used for fitting. Since the underlying mantid algorithm <code class="docutils literal notranslate"><span class="pre">PDCalibration</span></code> is based on single peak fitting, peaks with overlapping extents are excluded.</p>
<p>(n.b. In order to apply any modified parameters, it’s necessary to press the <code class="docutils literal notranslate"><span class="pre">Recalculate</span></code> button)</p>
<p>When the <code class="docutils literal notranslate"><span class="pre">Tweak</span> <span class="pre">Peak</span> <span class="pre">Peek</span></code> view is generated, an initial round of peak fitting is conducted and the resulting fits are overlayed across the diffraction data for each peak. “Good” fits - those that yield a <span class="math notranslate nohighlight">\(\chi^2\)</span> value less than a threshold (default is 100, this can be adjusted using the parameter <code class="docutils literal notranslate"><span class="pre">maxChiSq</span></code> in <code class="docutils literal notranslate"><span class="pre">application.yml</span></code>) - are coloured purple/blue and those that are bad coloured red . The goal is to achieve as many good peaks as possible. In <span class="xref std std-ref">Figure</span> several issues are immediately noticed. Firstly, the peak extent of the large peaks is clearly not sufficient to capture the long (Lorentzian) tails of the diamond peak shape. Secondly, many of the lower d-spacing peaks are coloured red indicating poor quality fits.</p>
<p>It is possible to zoom in and inspect details in any of the panels. Doing this in Group (ID: 2) (<span class="xref std std-ref">Figure</span>) shows that, not only are the peak extents too narrow, but the peaks in the focused calibration data are not well aligned with these. This is indicative of error in the uncalibrated <code class="docutils literal notranslate"><span class="pre">DIFC</span></code> values.</p>
<figure class="align-default">
<img alt="../_images/difcal2_zoom.png" src="../_images/difcal2_zoom.png" />
</figure>
<p>At this point, it’s possible for users to fine tune the peak extents. As described <a class="reference internal" href="../diffCalib/diffCal2.html#group-cal"><span class="std std-ref">here</span></a>, the (native resolution) FWHM of each peak is custom calculated for each peak and the symmetric part of the peak extent is governed by applying an independent multiplier for the left and right side of the peaks: <code class="docutils literal notranslate"><span class="pre">FWHM</span> <span class="pre">Left</span></code> and <code class="docutils literal notranslate"><span class="pre">FWHM</span> <span class="pre">Right</span></code>.</p>
<p>In this case, by adjusting these to <code class="docutils literal notranslate"><span class="pre">FWHM</span> <span class="pre">Left</span> <span class="pre">=</span> <span class="pre">3</span></code> and <code class="docutils literal notranslate"><span class="pre">FWHM</span> <span class="pre">Right=5</span></code> it was possible to make almost every peak turn purple/blue indicating a good quality of fit. (n.b. Again, to apply any modified parameters, it’s necessary to press the <code class="docutils literal notranslate"><span class="pre">Recalculate</span></code> button)</p>
<figure class="align-default">
<img alt="../_images/difcal2_zoom2.png" src="../_images/difcal2_zoom2.png" />
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At present, <code class="docutils literal notranslate"><span class="pre">SNAPRed</span></code> does not allow the possibility to use a pre-existing calibration for a given state to be used as a starting point for a subsequent calibration. Currently, this means that the starting point for calibration is instead the idealised detector locations defined in the instrument definition file.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It might be useful to have sample-dependent peak profile parameters in addition to the current instrument-dependent peak profile. These could follow GSAS convention <span id="id1">[<a class="reference internal" href="../bib.html#id8" title="A.C. Larson and R.B. Von Dreele. GSAS General Structure Analysis System. Los Alamos National Laboratory Report LAUR 86-748, 2004.">3</a>]</span> and could be stored in as parameters in the calibrant definition files. This would allow easy management of calibrants where sample-dependent broadening gives peaks that are significantly wider than the instrument resolution.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In testing it was found that for some long data collections the random error due to counting statistics becomes very small relative to the systematic error due to the peak shape. This can lead to <span class="math notranslate nohighlight">\(\chi^2\)</span> in excess of 1000. In this case, it may be necessary to increase the <span class="math notranslate nohighlight">\(\chi^2\)</span> threshold to allow the peaks to pass. As noted above, a longer term plan is to improve the peak shape used.</p>
</div>
<p>When the peak fitting configuration has been optimised, the <code class="docutils literal notranslate"><span class="pre">Continue</span></code> button should be used to initiate the Group Calibration component of the diffraction calibration workflow.</p>
</section>
<section id="third-tab-assessing">
<h2>Third tab: Assessing<a class="headerlink" href="#third-tab-assessing" title="Link to this heading">#</a></h2>
<p>This tab allows the user to load and pre-existing calibrations for the state to allow comparison with the present calibrations</p>
</section>
<section id="fourth-tab-saving">
<h2>Fourth tab: Saving<a class="headerlink" href="#fourth-tab-saving" title="Link to this heading">#</a></h2>
<figure class="align-default">
<img alt="../_images/difcal_save.png" src="../_images/difcal_save.png" />
</figure>
<p>Once the calibration is deemed complete. The user has to input some information to persist the output to disk. The only two mandatory inputs are <code class="docutils literal notranslate"><span class="pre">Comments</span></code> (used to record any useful observations during calibration or at least a statement like “OK”) and <code class="docutils literal notranslate"><span class="pre">Author</span></code> (the person who conducted the calibration). In addition, if multiple iterations were attempted during the process, the user must select which of these to persist.</p>
<p>Another useful field is the <code class="docutils literal notranslate"><span class="pre">Applies</span> <span class="pre">To:</span></code> field. This tells the software which run number the calibration applies to. While it defaults to the present calibration run, it is possible to specify a different run. A logical operator is expected to precede the number entered e.g. <code class="docutils literal notranslate"><span class="pre">&gt;=12345</span></code> with <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code> indicating that runs equal to or greater than run number 12345 will use this calibration. This information is written to the calibration index for the state, which is used during reduction to identify the correct calibration files and parameters.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./testPanel"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="overview.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Test Panel: User Guide</p>
      </div>
    </a>
    <a class="right-next"
       href="normcal.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">The NormCal Tab</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-tab-diffraction-calibration">First tab: Diffraction Calibration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explanation-of-fields">Explanation of fields</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#second-tab-tweak-peak-peek">Second tab: Tweak Peak Peek</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#third-tab-assessing">Third tab: Assessing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fourth-tab-saving">Fourth tab: Saving</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Malcolm Guthrie
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>